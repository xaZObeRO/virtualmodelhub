<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creator Dashboard</title>
<style>
body{font-family:Arial;background:#111;color:white;padding:20px;}
input,button{padding:10px 15px;margin:5px;border:none;border-radius:5px;cursor:pointer;}
button{background:red;color:white;}
.loop-item{border:1px solid #333;padding:10px;margin:10px 0;border-radius:5px;display:flex;flex-direction:column;align-items:flex-start;}
.loop-controls{display:flex;justify-content:flex-start;gap:10px;margin-top:5px;}
video{max-width:400px;border-radius:5px;margin-bottom:5px;}
.tip-btn{background:#ff2d55;color:white;border:none;padding:8px 15px;border-radius:20px;cursor:pointer;}
.tip-btn:hover{background:#d11b3c;}
.other-loop{opacity:0.5;}
</style>
</head>
<body>

<h2>Welcome, <span id="userEmail"></span></h2>
<input type="file" id="videoFile" accept="video/mp4">
<button onclick="uploadLoop()">Upload Loop</button>
<h3>Your Loops</h3>
<div id="loopsContainer"></div>
<h3>Other Creators Loops</h3>
<div id="otherLoopsContainer"></div>

<script>
let user = localStorage.getItem('currentUser');
document.getElementById('userEmail').innerText = user;

// Cargar loops desde localStorage
let loops = JSON.parse(localStorage.getItem('loops')||"[]");

function saveLoops(){ 
    localStorage.setItem('loops', JSON.stringify(loops)); 
    renderLoops(); 
}

function renderLoops(){
    let container = document.getElementById('loopsContainer');
    container.innerHTML = "";
    let otherContainer = document.getElementById('otherLoopsContainer');
    otherContainer.innerHTML = "";

    loops.forEach((loop,i)=>{
        let div = document.createElement('div'); 
        div.className = "loop-item";

        // Video preview
        let videoEl = document.createElement('video');
        videoEl.src = loop.url || URL.createObjectURL(loop.fileBlob || new Blob());
        videoEl.controls = true;
        videoEl.loop = true;

        // Info
        let info = document.createElement('div');
        info.innerText = `${loop.name} (${loop.duration}s) - Owner: ${loop.owner} - ${loop.active?"Active":"Inactive"}`;

        if(loop.owner === user){
            // Mis loops → controles completos
            div.appendChild(videoEl);
            div.appendChild(info);

            let controls = document.createElement('div'); 
            controls.className = "loop-controls";

            let toggleBtn = document.createElement('button');
            toggleBtn.innerText = loop.active?"Deactivate":"Activate";
            toggleBtn.onclick = ()=>{ loops[i].active=!loops[i].active; saveLoops(); };

            let deleteBtn = document.createElement('button');
            deleteBtn.innerText = "Delete";
            deleteBtn.onclick = ()=>{ loops.splice(i,1); saveLoops(); };

            let tipBtn = document.createElement('button');
            tipBtn.className = "tip-btn";
            tipBtn.innerText = "❤️ Tip this loop";
            tipBtn.onclick = ()=>{ window.open("https://TU-LINK-DE-PAGO-AQUI",'_blank'); };

            controls.appendChild(toggleBtn);
            controls.appendChild(deleteBtn);
            controls.appendChild(tipBtn);

            div.appendChild(controls);
            container.appendChild(div);

        } else {
            // Loops de otros perfiles → solo lectura
            div.classList.add('other-loop');
            div.appendChild(videoEl);
            div.appendChild(info);
            otherContainer.appendChild(div);
        }
    });
}

function uploadLoop(){
    let file = document.getElementById('videoFile').files[0];
    if(!file){ alert("Selecciona un archivo mp4"); return; }

    let fileURL = URL.createObjectURL(file);
    let duration = Math.floor(file.size/1000000*10); // simula duración

    loops.push({owner:user,name:file.name,duration:duration,active:true,url:fileURL,fileBlob:file});
    saveLoops();
}

renderLoops();
</script>

</body>
</html>
