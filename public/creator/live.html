<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Stream</title>
<style>
body{margin:0;background:black;display:flex;justify-content:center;align-items:center;height:100vh;}
video{width:100%;height:100%;object-fit:cover;}
</style>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "TU_SUPABASE_URL";
const SUPABASE_ANON_KEY = "TU_ANON_PUBLIC_KEY";
const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function loadLoop(){
    const ownerId = new URLSearchParams(window.location.search).get('user'); // ?user=UUID
    if(!ownerId){ document.body.innerHTML="<h2 style='color:white;'>User not specified</h2>"; return; }

    const { data: loops } = await supabase.from('loops').select('*').eq('owner', ownerId).eq('active', true).order('created_at',{ascending:false}).limit(1);
    if(loops.length>0){
        const video = document.createElement('video');
        video.src = loops[0].url;
        video.autoplay=true;
        video.loop=true;
        video.muted=true;
        video.playsInline=true;
        document.body.appendChild(video);
    } else {
        document.body.innerHTML="<h2 style='color:white;'>No active loop</h2>";
    }
}

window.onload=loadLoop;
</script>
</head>
<body>
</body>
</html>
